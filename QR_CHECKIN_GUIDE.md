# QR 체크인 시스템 가이드

## ✅ 구현 완료된 기능

### 1. 체크인 API (백엔드)
- **엔드포인트**: `GET /api/checkin?roomId={roomId}`
- **기능**:
  - 예약 시작 15분 전부터 체크인 가능
  - 예약 시작 후 15분 경과 시 자동 취소
  - QR 코드 스캔으로 간편 체크인

### 2. 자동 취소 스케줄러
- **실행 주기**: 매 1분마다
- **기능**:
  - 체크인하지 않은 예약 확인
  - 예약 시작 + 15분 초과 시 자동 취소
  - 로그 기록

### 3. 체크인 페이지 (프론트엔드)
- **경로**: `/checkin?roomId={roomId}`
- **기능**:
  - QR 스캔 후 자동으로 API 호출
  - 체크인 성공/실패 메시지 표시
  - 3초 후 자동으로 메인 페이지 이동

---

## 📋 남은 작업

### 1. QR 코드 생성 및 출력 기능
관리자 페이지에서 각 방마다 QR 코드를 생성하고 출력할 수 있는 기능이 필요합니다.

#### 필요한 라이브러리 설치:
```bash
cd frontend
npm install qrcode.react
```

#### 구현 내용:
- 관리자 페이지에 "QR 코드 관리" 탭 추가
- 각 방별로 QR 코드 생성
- QR 코드 내용: `http://localhost:3000/checkin?roomId={roomId}`
- PDF 출력 또는 이미지 다운로드 기능

### 2. 예약 목록에 체크인 정보 표시
- 메인 페이지의 "나의 예약" 섹션에 체크인 상태 표시
- 체크인 완료 시: ✅ 체크인 완료 (시간)
- 체크인 전: ⏰ 체크인 대기 중
- 예약 시작 15분 전부터 "체크인 하기" 버튼 활성화

---

## 🚀 사용 방법

### 관리자가 QR 코드 준비:
1. 관리자 페이지에서 각 방의 QR 코드 생성
2. QR 코드 출력 또는 저장
3. 각 방에 QR 코드 부착

### 사용자가 체크인:
1. 예약한 방에 도착
2. 방에 부착된 QR 코드를 스마트폰 카메라로 스캔
3. 자동으로 체크인 페이지 열림
4. 체크인 완료!

### 자동 취소:
- 예약 시작 후 15분 이내 체크인하지 않으면 자동 취소
- 스케줄러가 매분마다 확인하여 자동 처리
- 다른 사용자가 해당 시간대 예약 가능

---

## 🧪 테스트 방법

### 1. 수동 체크인 테스트:
```
http://localhost:3000/checkin?roomId=101
```
브라우저에서 직접 접속하여 체크인 테스트

### 2. 자동 취소 테스트:
1. 예약 생성
2. 15분 동안 체크인하지 않음
3. 스케줄러가 자동으로 예약 취소 (로그 확인)

### 3. QR 코드 생성 테스트:
온라인 QR 생성기 사용:
- URL: `http://localhost:3000/checkin?roomId=101`
- 생성된 QR 코드를 스마트폰으로 스캔하여 테스트

---

## 📊 데이터베이스

### reservations 테이블
- `checkin_time`: 체크인 시간 (DATETIME, NULL 가능)
- 체크인 전: `NULL`
- 체크인 후: 체크인한 시간 자동 기록

---

## ⚠️ 주의사항

### 체크인 가능 시간:
- **시작**: 예약 시작 15분 전부터
- **종료**: 예약 시작 후 15분까지
- 이 시간을 초과하면 예약 자동 취소

### 보안:
- 체크인 API는 로그인 필수
- 본인의 예약만 체크인 가능
- 다른 사람의 예약은 체크인 불가

---

## 🔧 추가 개선 사항 (선택)

1. **QR 코드 유효성 검증**:
   - 방별 고유 토큰 생성
   - QR 코드 위조 방지

2. **푸시 알림**:
   - 예약 시작 15분 전 알림
   - 체크인 완료 알림
   - 자동 취소 알림

3. **체크인 통계**:
   - 노쇼율 통계
   - 방별 사용률 분석

---

Copyright © 2025 한양대학교 사범대학. All rights reserved.

